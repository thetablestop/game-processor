if: tag IS blank
language: node_js
node_js:
- 12
env:
  matrix:
  - VERSION_PREFIX=1.0
  global:
  - secure: IeyFAV/8l75TgUOZUkfbnnEl4q8+yg/JnBUiji+eSP8Y3pMT6Nj8KCZrPEC7ToRgBckbk6MrjEbyCvH9R4iPcZScHGMyMFXDS+ZU38ExIogdVDUwh+bHZh8koG+5Z5tp4eumpP52vv3Nk8nTVQKBzAHJrWEIF2f62Fj3DA25xyoZtRyFlwZQqpe98IZ8yDAzYABFoxrZ25BR9F9memXpimQn9+Azdfgca2m8Q8oi60NxvQLz5yLnahZvVS8r3DaLl3j7YP8+5BZk00A24sP5CSNFt7rRyzPi831MiIdNUm0Ah7bnBGmccfvdsS3OBq3dAsyBjw9+GoOLaa5Icm42OyUb9DZy99U5wInhVWpHUwajoNAtSP1lTqwwWS7TbWRUjUilnxATTXITz6TfHF7AhaerbhuPLxKIcQmjyeZY58fm+geCH+MENXo9mUk7DR/9M26E8RGpirOWjMMViog3f1XYvk+WfRczNw9eiF95uQ3m4yGvlYK98t6T6vguUuvnwJG083EehjntdKASDwp4wGgJdrqKHHkQfilPmB4wqjQdsA1DZKCQ7fwGbh8TCivsEnFWAUjIa7l1cKqtOlL2s6il5g3m8b/pO+G8qwezpk9aG6lIqW0AxvfEZU7sDjX1kjyPharUTU3o9UzrOEVGcgqrBIgG35wzE0x9OnIXd6s=
  - secure: X+dLznwWZmqPPG+ORgBBXfRBKO1IKGbJyYGQAmhFSyTIlApOM4x+LWlMs+v6XRYx0cAUGL+MKr1AEvnp4iuzO46+OYrYsggxkkgNJz4We/tQS8H2QiM4gNQRPfH03D0SfHAJLxwARVIXTqXPs3Zwpp7XYtFHpJwjgc655PZiCY1/+m0WzivwA/p8THr46G2XPxpr04IMWBysEEjGai7AQOUCIS/AJtgRWXlBCY0tmwahLlhNyOlLjJ7ukplXWeD12V/R3hpFHCWZLqe6T3CqBEh0clDjDy1rGAOBQLsryt/LpvpRWlBD6CZiUX+un8gE+0D2Bq986cGZeMB2+F7a+fpqPtki0LgVdbvZZrU7MpnEGDq00rDL+EeQ2vaMvQ1gIw+9LSjTRmCKYVXvZVllMNPMKdEdbs9iOPabOWz9LuxhC8N0le0dbWloQFvqZB/zuoYuCxteezOl3captqqGOYlULkDKM6ObZakJv2FVH7zVoDGMqoypmWTIMdaTna91ZXpfBiIFH0gW01LDT2k8coLD0Cd5yR/Pellp6ocPPK2naG+hbDnrshUvCNJA5zdjAKZRNGWwtM3D3pZO09Oj61PSxe6JKPEpi8S7FBA91att5EgyUhWWjcto0EhaUMYFBuyjR6dFZpstO+r7wus3SXpYOsh5wGALTplTIYL+hFE=
  - secure: PEk42F3+sCXFl0iD0unS3hApCeYAu+Jv805oZ3oMTg5eoF+CnknKCKZNxY2zbxnQxFJlbC9KTCzD1Xq411ON5TgIX6KxIpLq93PC30C0oBfoAg5KFE5lzCVeJ5wHAMlJyH2KmlmrvIOSo3IPpqnjVl8N6wf92Ptv7+BdolxXrVXoEW9wA7MxTpBxv2hpX65wU03fFCj7q5X6lf5t9pQ+KYd6IFGniYdIqkVpISibwv1lHGuvhwOTaXXRHDIHlu5IZTk7JdivgSO+0pAKR3jaUo9TtaVYpYRqM2Xe9Ab1dudg/mU4omjamuJIAO9q3+rZSWmyDL4jFFZB+ao5oehRBsgGFFCqTv7EUlLpglzZlhyrZl9De0br7aV5rMRgqMSeADrnDRMD57KATQdb3rcohvGRBX+NfPHrMrJGzSWHbuSMxauxEmOipSojc1BqQCC0b74sohNTfEGfiZ07EN48WPr8Ff2CpKnKVwMnOHc4NREmO4n6gNBzyPzAPPtXHVuAPfraXYQk7DyMT8r/GwhFXP+sIAr/iAEw+94Fpwb4aGpWrzTf2JicyTdKhR1vQruOUpK0wT4APE0uf75/AKAksQWshSSSyClYgSmXeB47CVoXnrPvbCmYF37pUCSsnHOpY1hL7z+2Ro9BJ8CAX6M3TvjhFCmfj8LKbVWblMKAFzQ=
  - secure: lJ5ZackhTTVoy3DfuuOPREx+jDNWel7VFp9YpdcoEa22UDe1nGQGjeJPXdBNpwlQgZ1DTPjJpOPcfmyvBxjYGEjnp/pw0J25wXyih0BhUw12LP7od3bO/QAxGKNUzhFT/rnCj0AwFRRxdFBCEsZsPB+T0lr7wbOmFM6vQEwm7kDC+tXIZpgVevAt22klPNrz+OOyhNc5dbkZDWk04oHCYOjk5trAJZly+ELWcPgf7sNo5UbosJ/CAp+ehAL55Ceq38BuZ7FbPGmvkskTJU9Ufveg4ByUxKieh5TjLW8WrScqZDYYSGotfWh6IudpTGxvIth/H7kmMoM4XYKAobZDHdSOzw983y2wfyJaYNzVLDzCWlNnWGoQrxz9fbcSVtE+LAxshjRujDv1DYBr1SVyBiQ3jlGWB1ZGgabWTNzW3ifxP0aH2VVsaL68WeAXmUjZ3vzviYNlhGHkXS6m+Qu5b2gmXiecjyMkdhn1oodrNy8WOaazgEGttL7jr2O4UZwmdYYCb1Dnv3WVhdKxnj4Tp2Ahw7u5CRw8cCV+8mTaLzDk3WezzWCUstOsqDJ2bM3HlhS+h6Q5wG8RHiNZzvqGgQWkGLqRnDeyJ+AEVPVmD3SDZODW+rbR2+jpBfZiJTwGDxhz2ZexxdTQRY0wyBiPDHBfw6wdDU8dzNCWCZEt/L4=
notifications:
  slack:
    secure: EunTL3dttMiloJpzzvgnXmzEk4gfNtdFJJ4yaXpadoAVIEUhpACbAE0Ii7rC5Y4I9reAYgJtp8Y1lPdT6bz/FioP3tZmT5ybneF+Vza34QC4+Kcy/fSLHVP756bS8cNNsm5xHTuHIHNtRn53xwOQjWaXBzCdLK/IVY8efMi8f0qCaXoJdn0VPhgi7znA0Y7V8dJYVvgQufRI5gwuvtKZAkonamyPdpMGpm+6yUf6EfCXfCeWNqOaJvx9O5MQ3kCtjZM/3A6kRFLF9iFf+ss8TxKSt3t8rDAKs/jykHqW35ESYWK9F+xt2AmeaiG1wNAql1COcZspnsa0NXw3kZqNL8sgg1Ob0sPMZOR30ldnxxOcI68cHSkr8d3WGrro5RIw+4gWgzv57QdbVZaImF3veHllGIysHRjXxvUYdlnoGOdwasHwMR4WYrK5+Wqx+6Ll4wXnDJhMet9yD1gLV04j1CA6NQZGu4uFxu/drgU0+MrIqN/wwCl6EL5EYApD+172WqTc2QihJjfS2eMIxa0qFub11d9fsuZjqaIyzP7lVc9oexyKLMsM60YzLRiaRL9h0+cBcm29/NskMuj5hId7tWji84gDs3MZnZ3w8Z/6DdiIm6XJILAnXWcfw7QMK6QsP7ph5a1b8mrRoVfBwovHfV6X6wyA7Lxpt6uJBCXYiZM=
services:
- docker
jobs:
  include:
  - node_js: 12
  - stage: deploy
    if: "(NOT type IN (pull_request)) AND (branch = master)"
    script:
    - export FULL_VERSION=$VERSION_PREFIX.$TRAVIS_BUILD_NUMBER
    - export REPO_TAGGED=$TRAVIS_REPO_SLUG:$FULL_VERSION
    - export REPO_LATEST=$TRAVIS_REPO_SLUG:latest
    - echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker build -t $REPO_TAGGED .
    - docker tag $REPO_TAGGED $REPO_LATEST
    - docker push $REPO_TAGGED
    - docker push $REPO_LATEST
    - git config --global user.email "builds@travis-ci.com"
    - git config --global user.name "Travis CI"
    - git remote add tagorigin https://$GH_USERNAME:$GH_TOKEN@github.com/$TRAVIS_REPO_SLUG.git
    - git tag $FULL_VERSION -a -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
    - git push tagorigin --tags
